

# Chapter4 存储器4：局部性原理与缓存

## 1、为什么要有缓存？

## 2、程序的局部性原理

- 时间局部性
- 空间局部性

## 3、缓存的工作原理

## 4、Cache的基本结构

## 5、Cache的读写操作

## 6、Cache的改进

## 7、Cache-主存的地址映射

Cache和主存之间的地址的映射就是，我知道主存的地址，怎么找到对应的缓存的地址；我知道缓存的地址，怎么找到对应的主存的地址。很明显，他们之间需要一个第三方的映射表。

假设某个计算机的主存地址空间大小为256MB，按字节编址，其数据Cache有8个Cache行(即Cache块)，行长为64B.如下图7.1。为了方便主存和缓存的数据传输，主存的行

- 全相连映射(空位随意放)

首先给缓存按字节编址，因为一共有8个行，可以注意到图中蓝色的三位可以代表行号。

图7.1

![image-20200503213721266](assets/image-20200503213721266.png)

然后，给主存按字节编址

图7.2

![image-20200503213740875](assets/image-20200503213740875.png)

映射表要一个有效位，判断该缓存是不是已经有数据占用了。然后主存的主存的地址分为两个部分，一个是字块内地址，这个和缓存中的位数是一样的。另一个是主存字块标记，这个标记加上有效位构成映射地址。

电路复杂，速度慢，保存的位数多，比较器的长度长

- 直接映射(对号入座)

主存的块通过一定的计算方法存到某个固定的缓存块里。

主存地址 mod 缓存块数

内存块利用率不高

- 组相联映射

结合上面两个方法，先分组，在组内随意放。

![image-20200503224832295](assets/image-20200503224832295.png)



![image-20200503224852095](assets/image-20200503224852095.png)

比较：

![image-20200503225112769](assets/image-20200503225112769.png)

## 8、替换算法

RAND